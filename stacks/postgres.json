{
  "AWSTemplateFormatVersion" : "2010-09-09",
  "Parameters" : {
    "DatabaseName": {
      "Type": "String",
      "Description": "Name of the database",
      "Default": "hybox"
    },
    "MasterUsername": {
      "Type": "String",
      "Description": "Database Root Username",
      "Default": "root"
    },
    "DBInstanceClass": {
      "Type": "String",
      "Default" : "db.t2.medium",
      "Description": "Instance size"
    },
    "MasterUserPassword": {
      "Type": "String",
      "Description": "Password for the DB Root User"
    },
    "EC2SecurityGroup": {
      "Type": "List<AWS::EC2::SecurityGroup::GroupName>",
      "Description": "A list of security group names, such as my-sg-ab.",
      "Default": "default"
    },
    "AllocatedStorage" : {
      "Description" : "Size of DB in Gigs",
      "Type" : "String",
      "Default": "5"
    }
  },
  "Resources": {
    "DBInstance" : {
      "Type": "AWS::RDS::DBInstance",
      "Properties": {
        "DBName": { "Ref" : "DatabaseName" },
        "Engine": "postgres",
        "MasterUsername": { "Ref" : "MasterUsername" },
        "DBInstanceClass": { "Ref" : "DBInstanceClass" },
        "DBSecurityGroups": [ { "Ref" : "DBSecurityGroup" } ],
        "AllocatedStorage": { "Ref" : "AllocatedStorage" },
        "MasterUserPassword": { "Ref" : "DBInstanceClass" }
      }
    },
    "DBSecurityGroup": {
      "Type": "AWS::RDS::DBSecurityGroup",
      "Properties": {
        "DBSecurityGroupIngress": { "EC2SecurityGroupName": { "Fn::Join": ["", { "Ref" : "SecurityGroups" }] } },
        "GroupDescription"      : "Frontend Access"
      }
    }
  },
  "Outputs": {
    "EndpointAddress": {
      "Description": "Postgres endpoint address",
      "Value": {
        "Fn::GetAtt": [ "DBInstance", "Endpoint.Address" ]
      }
    },
    "EndpointPort": {
      "Description": "Postgres endpoint port",
      "Value": {
        "Fn::GetAtt": [ "DBInstance", "Endpoint.Port" ]
      }
    }
  }
}
